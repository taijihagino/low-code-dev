# 概要
この章では、Node-REDで簡単なToDoアプリケーションを作成します。とても簡単でわかりやすく、Node-REDでアプリケーション（フロー）を作成するための良い内容になっています。このシナリオでは、Node-REDの「プロジェクト」機能を使います。

以下の4つの流れで進んでいきます：

- Node-REDをWebアプリケーションに使う理由を知る
- データベースの作成
- データベースの接続設定
- アプリケーションの実行

このセクションを実施することで、Node-REDでデータベースを使った簡単なWebアプリケーションを作る方法をマスターしているでしょう。

## 技術的要件
このセクションを実施するには、以下のものが必要です：

- [node.js 10.x または 12.x.以上](https://nodejs.org/)
- [CouchDB 3.x以上](https://couchdb.apache.org/)
- [GitHubアカウント](https://github.com/)

この章で使用されるコードは、[https://github.com/PacktPublishing/-Practical-Node-RED-Programming](https://github.com/PacktPublishing/-Practical-Node-RED-Programming)にあります。

# WebアプリケーションにNode-REDを使う理由を知る
本来、Node-REDは特にIoTで使いやすいツールであると位置づけられていました。実際、IoT分野のソリューションでNode-REDが使われるケースは多いです。<br>
しかし、最近ではIoTだけでなく、Webアプリケーションを作るツールとしてもNode-REDが認知されるようになってきました。<br>
その理由のひとつは、No-Code、Low-Codeという考え方が世の中に浸透してきたことだと思います。今、フローベースのプログラミングツールやビジュアルプログラミングツールの認知度は高まり、さまざまな分野で活用されています。<br>
その中でも、Node.jsで作られたNode-REDがWebアプリケーションに使われるのは自然な流れでしょう。<br>
数年前に機能追加された、Git/GitHubとの連携によるプロジェクト機能も、Node-REDがWebアプリケーション開発文化に近づいた理由の一つかもしれません。

## アプリケーションの全体像
このセクションでは、学習用のアプリケーションとして非常に適したToDoアプリケーションを作成します。<br>
作成するアプリケーションの全体像は次のとおりです。

<img width="1141" alt="Screenshot 2024-01-28 at 22 25 42" src="https://github.com/taijihagino/low-code-dev/assets/12064399/1a105c32-1509-44f1-a3ee-ba9cc8f20f6f"><br><br>

このアプリケーションでは、ユーザーインターフェイスとバックエンドアプリケーションはNode-RED上で構築されていません。<br>
アプリケーションの実態は、Node.jsアプリケーションとしてローカルホスト上に直接実装されています。後ほど説明しますが、Node-REDが動作しているlocalhostのポートにアクセスすると、localhostのNode.jsアプリケーションにリダイレクトされるように設定します。<br>

## 利用するフレームワーク
この演習の前に、このアプリケーションに使われる2つのフレームワークを知っておく必要があります。前述の通り、このセクションでは、Node-REDを使ってToDoアプリケーションを作ります。このアプリケーションは、以下の2つのNode.jsフレームワークによって実装されます：

**[TodoMVC](http://todomvc.com/)**

<img width="848" alt="Screenshot 2024-01-28 at 22 28 55" src="https://github.com/taijihagino/low-code-dev/assets/12064399/a3e6e7a1-f65d-4e94-ab4d-bf919bf3b8ba"><br><br>

**[Todo-Backend](https://todobackend.com/)**

<img width="852" alt="Screenshot 2024-01-28 at 22 29 08" src="https://github.com/taijihagino/low-code-dev/assets/12064399/e6c1e178-847e-453f-bdf1-b75b2697f840"><br><br>

Node-REDは、Node.jsで実装されたWebアプリケーションやその周辺のフレームワークと非常に相性が良いです。現在、Node-REDがIoTソリューションだけでなく、Webアプリケーションの開発（No-code / Low-code）にも人気がある理由は、そういったところにあるのだと思います。

それでは、演習にに入っていきましょう。


# 開発手法
## データベースの作成
前項でアプリケーションの全体像を紹介しましたが、このアプリケーションではデータベースにCouchDBを使用しています。<br>
今回のハンズオンでは、localhost上で動作するNode-REDでアプリケーションを作成しますので、ご自身のローカルマシンにもCouchDBをインストールしてください。<br>
以下の手順に従ってください。

１．[CouchDBのウェブサイト](https://couchdb.apache.org/)にアクセスします。そして、「DOWNLOAD」ボタンをクリックします。

<img width="830" alt="Screenshot 2024-01-28 at 22 35 41" src="https://github.com/taijihagino/low-code-dev/assets/12064399/f7a27771-f5f8-4bc6-bd62-b0c1f00a6aed"><br><br>

２．自分のマシンに適したファイルを選択します。

<img width="829" alt="Screenshot 2024-01-28 at 22 35 51" src="https://github.com/taijihagino/low-code-dev/assets/12064399/cd6d580e-072e-421f-9704-50edb5e7f093"><br><br>

３．ダウンロードが完了したら、ダウンロードしたzipファイルを展開し、CouchDBを起動するアプリケーションファイルを実行します。

<img width="643" alt="Screenshot 2024-01-28 at 22 36 03" src="https://github.com/taijihagino/low-code-dev/assets/12064399/b59f2bfc-e9bb-4c02-b35c-195f5c6ea663"><br><br>

４．CouchDBアプリケーションファイルを実行すると、管理者（admin）用にパスワード設定を促されます。ここでは、パスワードとして "adminpass "を設定します。

<img width="303" alt="Screenshot 2024-01-28 at 22 40 30" src="https://github.com/taijihagino/low-code-dev/assets/12064399/0f1b8067-3282-4fea-b30e-e27ccdb1583c"><br><br>

５．ブラウザが起動し、CouchDB管理コンソールが開きます。先程のadmin/adminpassでログインします。

<img width="1434" alt="Screenshot 2024-01-28 at 22 43 22" src="https://github.com/taijihagino/low-code-dev/assets/12064399/db0dafd7-685a-4d90-9ec5-3a8611d22c2b"><br><br>

６．CouchDB管理コンソールでは、新しいデータベースを作成します。名前 "todos "でそれを作成します。パーティションは必要ありません。最後に、[作成]ボタンをクリックして完了します。

<img width="333" alt="Screenshot 2024-01-28 at 22 36 38" src="https://github.com/taijihagino/low-code-dev/assets/12064399/b11d5e1c-68b1-422b-b36b-2869141235cf"><br><br>

７．あなたのCouchDBの管理コンソールに "todos "という名前のデータベースが表示されます。

<img width="1098" alt="Screenshot 2024-01-28 at 22 36 54" src="https://github.com/taijihagino/low-code-dev/assets/12064399/e0ecf3db-96f9-43a3-a65d-c442f1df0186"><br><br>

これで、CouchDBに関連するすべての設定が完了しました。次に、Node-RED側の作業に移ります。

## Node-REDとデータベースの接続設定
この演習では、Node-REDのフローをGitHubからクローンします。Node-REDのプロジェクトの機能を使ってGitHubのリポジトリに接続し、用意したフロー定義ファイルを読み込んで、ローカル環境のNode-REDに実装します。そのため、今回はフローを作成する必要はありません。

### Node-REDの設定
まず最初に、やっておかなければならないことがあります。それは、Node-REDフローエディタのローカルホストのパス（URL）を変更することです。<br>
現在、フローエディタにはlocalhost:1880でアクセスできますが、この演習で作成したWebアプリケーションのパス（URL）にlocalhost:1880でアクセスできるよう変更するためには、フローエディタのパスを別のパスへ変更する必要があります。ここでは、「localhost:1880/admin」に変更しましょう。<br>
これは、Localhost上の同じポートで動作しているNode.js ToDoアプリケーションにアクセスするために、Node-REDフローエディタのルートパスを移動する必要があるためです。

以下の手順に従ってください。

１．設定ファイルを開きます。

```~/.node-red/settings.js```

２．setting.jsを開いたら、httpAdminRootの設定を探します。これはNode-REDフローエディタにアクセスするパスを指定します。デフォルトではルートパス/を使用していますが、今回のアプリケーションではそのルートパスを使用したいので、この設定を使ってエディタのパスを移動します。デフォルトではコメントアウトされています。そのため、行頭の"//"を削除してコメントアウトを解除します。

<img width="813" alt="Screenshot 2024-01-28 at 22 54 53" src="https://github.com/taijihagino/low-code-dev/assets/12064399/b1f42583-a9af-4570-a4cf-273675931ced"><br><br>

３．フローエディターを/adminに移動しました。ローカルマシンでNode-REDを再起動してください。そしてURL「http://localhost:1880/admin」にアクセスしてNode-REDフローエディタを実行してください。

### Node-REDプロジェクトのクローン
この演習では、Node-REDプロジェクトのサンプルを提供します。このプロジェクトをあなたのローカルのNode-REDにクローンする前に、まずプロジェクトをフォークして、あなた自身のコピーを作成してください。<br>
フォークした後、プロジェクトをNode-REDインスタンスにクローンします。

以下の手順に従ってください。

１．https://github.com/taijihagino/node-red-todo-app でサンプルプロジェクトを開きます。

２．フォークボタンをクリックして、リポジトリのコピーを作成します。

３．https 経由でフォークをクローンするための URL をメモしておいてください。

４．Node-REDエディタにアクセスします - http://127.0.0.1:1880/admin/

５．Projects Welcome 画面の Clone Repository ボタンをクリックします。この画面を閉じてしまった場合は、メインメニューの Projects -> New で再度開くことができます。

<img width="990" alt="Screenshot 2024-01-28 at 23 05 56" src="https://github.com/taijihagino/low-code-dev/assets/12064399/a859361d-595e-468a-b206-056e914bbcce"><br><br>

※ もし、メニューにProjectが出現してない場合、setting.jsのprojectsセクションでenabledをfalseからtrueへ書き換えてください。

<img width="1138" alt="Screenshot 2024-01-28 at 23 03 42" src="https://github.com/taijihagino/low-code-dev/assets/12064399/b2cad3d9-3fc3-452e-9a25-fb1cf16be34f"><br><br>

６．プロジェクト画面で、リポジトリのURL、ユーザー名、メールアドレスを入力してください。これらはプロジェクトに変更をコミットするときに使用します。ローカルの git クライアントがすでに設定されている場合は、これらの値を選択します。Credentials encryption key フィールドは空白のままでかまいません。

<img width="622" alt="Screenshot 2024-01-28 at 23 11 30" src="https://github.com/taijihagino/low-code-dev/assets/12064399/2c0b9ab5-eb72-41ef-b93b-a2d61e404305"><br><br>

７．これでリポジトリが新しいローカルプロジェクトにクローンされ、実行が開始されます。ワークスペースでは、アプリケーションのREST APIの各部分を実装したフローを見ることができます。<br>
全てのcloudantノードでいくつかのエラーが表示されますが、これらのエラーの原因は接続設定にあります。これらの設定はこの後のステップで行うので、とりあえず問題はない。



## トライアルアカウントの作成
トライアルアカウントを作成については[こちらの「OutSystemsアカウントの作成と開発環境準備」](../../チュートリアル/Contents/0.%20OutSystemsアカウントの作成と開発環境準備.md)を参照してください。<br>

# 応用編ワークショップへ進む
次の章：[Order Management 概要](./1.%20Order%20Management%20概要.md)へ進む。
