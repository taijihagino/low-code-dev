# 概要
このセクションでは、[前章](./2.%20Order%20Management%20App%E3%81%AE%E4%BD%9C%E6%88%90.md)で作成した注文管理アプリケーションを拡張していきます。今回は新しい検索機能を作成し、コード、ステータス、価格帯で注文を検索できるようにします。このチュートリアルでは、2つの主要なステップに焦点を当てます。

**注文画面に3つの検索入力を追加する：**

- ユーザーが注文コードを入力できる入力フィールド
- ユーザーが選択できるステータスのドロップダウン
- 価格帯で注文をフィルターするために調整できる範囲スライダー

**注文画面の2つの新しいシナリオのUIをデザインする：**

- アプリにまだ注文がない場合
- 検索フィルターが注文を返さない場合

これらの要件をゼロから実装し、その過程でOutSystemsの重要な側面を理解します。

## シナリオ
この時点で、アプリには前の練習で作成した2つのScreen（画面）があります：

- Orders（注文）: すべての注文とその最も重要な情報を一覧表示します。
- Order Deital（注文詳細）: 日付、ステータス、注文コードなど、注文の関連情報を表示、編集できるフォームがあります。

このチュートリアルでは、「Orders」画面のみを使用します。

### Orders Screen（注文画面）
Orders Screenには、Code（コード）、Total Amount（合計金額）、Order Date（注文日）、Order Status（注文ステータス）が表形式で表示されます。

このScreenには、3つの方法で注文をフィルタリングできる検索エリアがあります：

- Codeで注文をフィルタリングするためのテキスト入力フィールド
- Statusで注文をフィルタリングできるドロップダウン
- Total Amountで注文をフィルタリングできる範囲スライダー

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/45a18fe8-ee89-4e09-83cc-78939a69d743)<br><br>

さらに、画面に注文が表示されない場合、いくつかの情報とオプションをユーザーに表示するためのUIも追加します。

検索条件の結果、注文がない場合、Orderes Screenは次のようになります：

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/e3f81ac8-fd33-4dd8-af29-c785f1fcd22b)<br><br>


また、まだ注文がない場合、画面はこのようになるはずです：

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/12a9d8df-8309-439f-8dfc-acb865a74dab)<br><br>

# 開発手順
シナリオがわかったところで、この開発手順に従って注文管理アプリを拡張していきましょう。

## リソース
このハウツー・ガイドには、必要な2つの画像があります： 

- BlankSlate_NothingToShow
- BlankSlate_NoResultsFound

これらの画像は、Orders Screen（注文画面）に注文が表示されていない場合のUIを作成するために使用します。

[Materials](./Materials/3.%20注文のフィルタリング)からダウンロードしてください。

## 開発準備
このセクションでは、すでに前のセクションを実施しており、2つのScreen（画面）とData Model（データモデル）が作成できていることを前提とします。

まだ作成していない場合は、[前のセクションに戻って](./2.%20Order%20Management%20App%E3%81%AE%E4%BD%9C%E6%88%90.md)アプリケーションを作成する必要があります。

この演習を開始するには、OrderManagementモジュールを開いたService Studioが必要です。アプリケーションが以下の画面のように表示されます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/062fc17b-8702-461d-ab04-24b150783b04)<br><br>

表示されていない場合は、Service Studioでアプリケーションとモジュールを開いてください。

### Outdated Dependencies（古い依存関係）
前のセクションでも説明しましたが、古い依存関係があることを知らせるポップアップメッセージが表示される場合があります。OutSystemsでは、常に新しいバージョンのコンポーネントを提供しようとしているので、これは正常な挙動です。

そのような場合は、「Manage Dependencies（依存関係の管理）」というボタンをクリックするだけで、古いコンポーネントが表示されます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/b89bd2de-d221-4398-87b2-f26ddbfb897a)<br><br>

そして、「Refresh all」をクリックして一度にすべてを更新し、完了したら「Apply」をクリックします。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/78cd5faa-4457-4532-8720-734fcd660f34)<br><br>

次に、プロジェクトを更新するためにモジュールをPublishします。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/38c004b3-747b-496b-9457-e66090049f5f)<br><br>

## 新しい検索セクションの追加
前のセクションでは、アクセラレータ（スキャフォールディング）を使用してOrders Screenを作成しました。この画面は、コードで注文を検索できる検索機能を備えた形で既に作成されています。ここでは、他の検索機能を追加して、エンドユーザーがステータスや価格帯でも注文を検索できるようにします。

フィルタの検索エリアを作成し、その新しいエリアに既存のフィルタを配置していきましょう。

１．Interfaceタブで、「Orders Screen」をダブルクリックして開きます（まだ開いていない場合）。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/d8c54653-570d-42a7-852b-2233d220f021)<br><br>

２．Widgetタブを選択します。ツールボックスから新しい「Container」をドラッグし、OrdersのTableのすぐ上のあたりにドロップします。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/de2728d1-4bf9-4ce3-8bc0-16f1884beddb)<br><br>

３．右側のサイドバーにContainerのプロパティが表示されます。「Style」タブをクリックして切り替えます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/33f00510-8ffc-4d61-8dfc-4cedeb772f49)<br><br>

４．切り替えたStyleタブ内の「Layout」にて、下に20pxのマージンを追加する。これで、このコンテナとその下のテーブルの間にスペースができます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/f630f315-cdc0-4966-9b47-fa7308ab0f9d)<br><br>

５．Orders Screenに戻り、ツールボックスから「Columns 3」ウィジェットをドラッグし、先ほど作成したコンテナ内にドロップします。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/77feee3c-1ce4-47b3-bb27-930a47bd7dbc)<br><br>

これで、画面上では3列に分割されているのがわかります。

６．画面に存在する「検索用のInput」を選択します。「Interaction\Search Element」が選択されていることを確認します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/7ac58a71-9409-413b-ab9d-0418018332de)<br><br>

７．Elementをドラッグして最初の列にドロップします。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/e77a601f-d02b-413d-91b2-adba16c40e04)<br><br>

８．移動させた「検索用のInput」をクリックし、右のサイドバーを見てください。「プロパティ」タブに切り替えます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/2d4415ca-b390-4f18-b24b-587753b60065)<br><br>

９．プロパティの「Prompt」に「"(Search by code)"」と入力します。これは、ユーザーが検索入力に何も入力していないときに表示されるものです。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/a527228f-3b59-4716-af69-a276c5a15ef1)<br><br>

１０．アプリケーションをPublishし、ブラウザで開きます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/7a48dc0c-b13f-4e0f-8290-7ee2b624ab5b)<br><br>

１１．コードで注文を検索してみて、すべて正常に機能していることを確認してください。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/43460340-0453-4656-9cdb-4781b0b0ad2a)<br><br>

## Statusでの検索
ここからは、すべての有効なステータスを表示するドロップダウンを使用して、ステータスによる検索を追加します。ユーザーが特定のステータスを選択した場合、そのステータスの注文のみがテーブルに表示されます。まずは、ドロップダウンを実装してみましょう。

### Status Dropdownの作成
１．ツールボックス（左サイドバー）からDropdownをドラッグし、Containerの2列目にドロップします。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/f60d601b-e46f-4ede-9805-2bb3b527faa9)<br><br>

Dropdownのプロパティにはいくつかのエラーが含まれますが、心配しなくて大丈夫です。次のステップで修正します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/707fffd3-e4d1-4c06-b4b6-2ec1037c28de)<br><br>

２．最初のエラーはVariableプロパティです。このプロパティは、ユーザーが選択したオプションが保存される場所を示します。Variableプロパティをクリックし、「New Local Variable」を選択します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/753c6412-af07-47ac-be7b-c2c7b5400bfa)<br><br>

３．作成したLocal VariableのNameプロパティに「SearchedStatus」と入力します。

４．Data Typeを「OrderStatus Identifier」に変更します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/dabd5e08-8e48-414f-9fe6-b69cdb691c52)<br><br>

注文画面のみに存在する Local Variable を作成します。データ型は、OrderStatus Identifier に設定されています。この変数は、ユーザによって選択されたステータス（draft、submitted、approved、または rejected）を保持するためです。

Dropdownを選択し、次に修正する必要があるエラーを確認すると、Listプロパティであることがわかります。このプロパティは、Dropdownに表示され、ユーザーが選択できるElementのリストにしたいと思います。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/ad9d95c6-ba76-4882-bcc2-1dca2c739d16)<br><br>


５．Orders Screenを右クリックし、Fetch Data from Databaseを選択します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/910e64ef-4cf0-40a7-847b-45426a27a7c5)<br><br>

Aggregate を作成しています、 これは OutSystems がデータベースからデータを取得するために使用するものです。

６．表示された新しいダイアログで、ハイライトされた部分のどこかをクリックします。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/ac44ff65-4b27-453c-8541-b6e582094bc1)<br><br>

７．OrderStatus Entity を選択します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/ae4e0c59-257c-43fd-834e-dc0041f8ecc9)<br><br>

Aggregateの名前が自動的に「GetOrderStatuses」に変更されることを確認してください。OutSystemsでは、最も直感的な方法でElementに名前を付けようとします。このAggregateは、データベースで利用可能な注文のすべてのステータスを取得します。

８．InterfaceタブのOrdersをダブルクリックしてOrders Screenに戻ります。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/5776f6a5-ce1c-4d77-a983-6ba1000a3fec)<br><br>

９．Dropdown Widgetのプロパティを開き、Listドロップダウンを展開し、先ほど作成した新しいAggregateの出力にプロパティを関連付けるために、Suggestionから「GetOrderStatuses.List」を選択します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/b627d6f5-21b2-4ee0-aed1-3aa6ff6dd4ff)<br><br>

残りのプロパティは自動的に入力され、エラーはなくなりましたね。

１０．Empty Textプロパティに「"(Search by Status)"」と入力して変更しましょう。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/d4730906-f616-4fbf-aef4-888c60cd9dbb)<br><br>

このプロパティは、「Search by code」入力フィールド用に編集したプロンプトに似ています。これは、ユーザーがオプションを選択する前に表示されるテキストです。

### Statusによる絞り込み検索
ドロップダウンは完全に実装されましたが、注文リストにどのような影響を与えるのでしょうか？ユーザーが選択したオプションがテーブルに表示される注文に影響を与えることを確認する必要があります。

１．InterfaceタブでOrders Screenを展開し、Aggregateの「GetOrders」をダブルクリックして開きます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/85b0288d-d09c-4ea6-8883-ff57413a8815)<br><br>

これは、画面に表示されるすべての注文を取得するAggregateです。

２．Filter タブに切り替えます。コードによる検索に関連するフィルターがすでに作成されていることがわかります。ここで、Dropdownを使って新しいフィルターを追加する必要があります。「Add filter」ボタンをクリックしてください。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/623577c9-ca9e-4cba-af4e-a08403cddead)<br><br>

３．新しいダイアログに以下の式を追加し、完了したら「Close」をクリックします。

```SearchedStatus = NullIdentifier() or SearchedStatus = Order.OrderStatusId```

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/55de6338-e014-4d16-ad9f-8b916713d7c1)<br><br>

ご覧のように、SearchedStatus変数を使って注文をフィルタリングしており、ユーザーが選択したオプションが保存されています。

## データの更新
この段階で注意しなければならないことが1つあります。ユーザーがDropdownでステータスを選択すると、注文のリストが自動的に更新されるようにしたいのです。少し前の手順で、すでにコードによる検索を試したことを覚えていますか？つまり、ロジックはすでにあるということです。

１．注文画面に戻って、もう一度Dropdownをクリックしてみましょう。

２．On Changeプロパティが表示されるまで、プロパティエリアを下にスクロールします。そのドロップダウンを展開し、「OnSearch」Actionを選択します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/63859e06-abc2-4954-b84e-014d5428658e)<br><br>

On Changeプロパティは、ユーザーがドロップダウンのオプションを選択すると自動的に実行されます。OnSearchアクションは、ここで必要とするロジックが実装されているActionです。試してみましょう。

３．アプリケーションをPublishし、ブラウザで開いてください。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/aeb1366b-665e-46ba-9844-3e82729016eb)
![image](https://github.com/taijihagino/low-code-dev/assets/12064399/1315b5b7-7afc-493a-98e5-4214e35dcccd)<br><br>

４．ドロップダウンを使ってステータス別に注文を検索してみましょう。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/ad73d1a9-5313-448f-9b8b-1f104706599d)<br><br>





