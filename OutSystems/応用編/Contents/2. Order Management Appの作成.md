# 概要
このワークショップでは、OutSystems の IDE である Service Studio を使用して、ゼロから注文管理アプリケーションを構築します。

注文管理アプリケーションの作成は、まずデータモデルを定義し、そこから2つの画面を作成していきます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/b16c61f9-c6a7-483f-abdf-e6378afee0f5)<br><br>

後ほど、ブラウザでアプリを開いて試すことができるようになります。


## シナリオ
顧客からの注文を管理するためのWebアプリケーションを作成したいと思います。ここでは、注文管理アプリケーションとその最初の2つの画面を作成します：

- 注文: すべての注文とその最も重要な情報を一覧表示します。
- 注文詳細：日付、ステータス、注文コードなど、注文の関連情報を表示、編集できるフォームがあります。

データも画面もない空のアプリから始めます。最初のステップは、Excelファイルから商品データをインポートすることです。

### データモデル
すべてのアプリケーションは、さまざまなビジネス・コンセプトを表すデータを格納および取得する必要があります。

OutSystemsでは、これらの概念はモデル化され、データベース・エンティティと呼ばれます。このアプリケーションには、4つのデータベース・エンティティがあります：

- Item (商品)：データベース内のすべてのアイテム（商品）とその詳細（名前や価格など）を保持します
- Order (注文)：日付やコードなどの注文の詳細を持ちます
- Order Item (注文商品)：これは、注文と商品の間の関係を作成するための補助エンティティです
- Order Status (注文ステータス)：注文に対してのすべてのステータスです

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/2a5d55e4-639f-46d9-9760-65bc1b80e858)<br><br>

### 注文一覧画面
注文一覧画面では、コード、合計金額、注文日、注文ステータスが表形式で表示されます。

この画面には、コードで注文をフィルタリングするためのテキスト入力フィールドがあり、そのすぐ隣には、ユーザーが新しい注文を追加するためのボタンがあります。

注文画面は次の画像のようになります：

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/04160718-476d-41ef-a982-1c391613acaf)<br><br>

### 注文詳細画面
注文詳細画面は、特定の注文のすべてのフィールドを表示します。

このアプリケーションのユーザーは、2つの方法でこの画面に移動することができます：

- 注文画面で注文コードをクリックする
- 新規注文を追加するオプションをクリックする

前述したように、この画面は注文の詳細を表示するために使用されますが、ユーザが注文データを修正し保存することもできます。そのために、画面には注文情報をデータベースに保存するロジックを実行するSaveボタンも必要です。そのすぐ隣には、注文画面に戻るための戻るボタンも設置します。

注文詳細画面は下の画像のようになります：

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/6b0c5e8e-8443-4837-a33b-6dcfb12d0109)<br><br>

# 開発手順
シナリオがわかったところで、このガイドに従って注文管理アプリを作りましょう！準備はいいですか？一緒に進めていきましょう！

## リソース
このワークショップには、アプリ開発に必要な2つのリソースがあります：

- **Order Management.oap** ファイル：これから作成するアプリケーションのクイックスタートです。すぐに始められるようにしてある空のアプリです。機能はまだ作成していません。

- **Items.xls** ファイル：いくつかのサンプルデータを含むエクセルファイルです。もし必要であれば、もっとデータを追加したり、自分のオリジナルデータでExcelファイルを作ったりすることも可能です。ただし、独自で用意したデータと、このガイドがミスマッチにならないように、少なくとも今のところは、同じ列と列見出しを保つようにしてください。

[Materials](../Materials/)からダウンロードしてください。

## 開発準備
前の手順でダウンロードした、クイックスタートファイル「Order Management.oap」をインストールすることから始めましょう。

このファイルには、OrderManagementという名前の1つのモジュール、1つのアイコンと小さな説明を持つアプリケーションがあります。

このモジュールには、OrderManagementという名前のアプリケーションが1つ、アイコンが1つ、小さな説明が1つあります。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/70d925bc-8ed3-47be-b280-919389ef39f7)<br><br>

１．Service Studio（IDE）のメインウィンドウで、ウィンドウ左上の「Environment」メニューをクリックし、「Open Files....」を選択します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/1dd4e106-ac1b-43e1-8d0a-06733f1990cf)<br><br>

２．ダイアログが開いたら、リソース・ファイルがあるフォルダに移動し、ファイル・タイプを OutSystems Application Pack (.oap) に変更します。これで、「Order Management.oap」 というファイルが表示されます。ファイルをダブルクリックして開きます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/698104b7-e007-4f9c-b10c-be27e44d2b4e)<br><br>

３．Service Studioに表示される新しい確認ダイアログで、「Proceed」を選択します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/a451ef95-de87-4f8a-b175-5454e1e098f2)<br><br>

４．アプリケーションが自動的にインストールを開始します。完了するまでしばらくお待ちください。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/39c46436-48d8-41ca-ad2f-b3038aa3a6fc)<br><br>

５．インストールが完了したら、アプリケーションアイコンをクリックしてIDEを開きます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/1cc4b745-113b-48a1-a826-96c32608f06c)<br><br>

６．このアプリケーションにはモジュールが一つしかありません。モジュール名をクリックして開いてみましょう。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/31a904d9-1a50-456d-ae56-3e7e3409a133)<br><br>

OutSystemsでは、アプリケーションはモジュールの集合です。UIやビジネスロジックからデータまで、アプリケーションの要素を開発するのはモジュールの中となります。

７．モジュールを開いたので、新しいアプリごとに自動的に作成されるログイン画面が表示されます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/6200c654-e4ac-4344-8944-6034520b5a1c)<br><br>

### 注意事項
古い依存関係があることを知らせるポップアップメッセージが表示されるかもしれません。OutSystemsでは、常に新しいバージョンのコンポーネントを提供しようとしているので、これはよくあることです。

そのような場合は、「Manage Dependencies（依存関係の管理）」というボタンをクリックするだけで、古いコンポーネントが表示されます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/d880ad3b-6081-4794-b823-ef2e6150442b)<br><br>

そして、「Refresh all」をクリックして一度にすべてを更新し、完了したら「Apply」をクリックします。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/400908fd-7037-419e-9e29-f982c47e50dd)<br><br>

次に、プロジェクトを更新するためにモジュールをPublishします。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/05e1744d-8397-4e3f-8657-fd7fedda5535)<br><br>

Service Studioのワークスペースは、アプリケーションのモジュールを設計、デプロイ、デバッグする場所です。ここでアプリの作成作業を行います。

Service Studioを初めて使う場合は、ツールボックス、1-Click Publishボタン、レイヤータブ、プロパティエディタなど、ワークスペースを構成するさまざまな領域を把握しておくと良いでしょう。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/bdf1296f-091a-4a59-ab35-60dadbb68b0e)<br><br>

## エクセルファイルからデータをインポート
さて、アプリをインストールしたところで、データを追加するところから始めましょう。このセクションでは、注文に追加できるアイテムのデータを保持しているエクセルファイルから、そのデータをインポートします。

１．Service Studioで右上のDataタブを選択します。Service Studioでアプリのデータを確認したり定義したりするエリアが開きます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/c3ee3106-9bcc-4609-84bb-33ed680d481b)<br><br>

２．Entitiesを展開し、Database要素を右クリックして、「Import New entities from Excel...」を選択します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/38aa1ac7-3dfa-4955-8985-87ad8ba999f3)<br><br>

３．表示された新しいダイアログで、Items.xlsx ファイルがあるフォルダに移動し、それを選択します。

４．作成されるエンティティ名を示すダイアログが表示されます。ここにItem Entityが表示されていることを確認します。Import をクリックしてください。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/27ed55c9-0cd6-4579-b378-2c5abfe5c62e)<br><br>

OutSystems は、Excelファイルを分析し、Excelファイルのシートごとに1つのEntityを作成します。

EntityがDatabaseに作成され、それを展開すると、Attirbuteも自動的に作成されたことがわかります。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/740123d2-2448-4b84-a4a3-4c3adfe92fde)<br><br>

Attirbuteは、インポートしたExcelファイルの列を指します。OutSystemsは各列を調べ、各行の内容を分析し、列の名前と適切なデータ型を持つAttirbuteを自動で作成します。

これは、OutSystemsにデータをインポートする方法のうちの１つです。データモデルをゼロから作成することもできますし、他のデータソースからデータをインポートすることもできます。また、独自のExcelファイルを編集または作成することもできます。シート名と列名は、Entity名とAttirbute名でもあることに注意してください。

５．Attirbuteの「Price」をクリックしてプロパティを表示し、プロパティのData Typeのドロップダウンで「Currency」を選択します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/c3d483f1-2272-4335-a72c-cdd3648a6718)<br><br>

## ゼロから（スクラッチで）Entityを作成する
Excelファイルを使用してデータベースにEntityを作成しました。しかし、注文などの他の重要なデータを格納するために、さらにいくつかのエンティティが必要です。

１．Databaseを右クリックし、「Add Entity」をクリックします。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/b6aa460b-8527-4c18-9d72-f06096d69602)<br><br>

２．プロパティエディタをクリックし、新しく作成されたEntityの名前に「Order」と入力します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/8f7d8cfb-2dbe-4701-9d6a-b52dfe3f72e7)<br><br>

３．Renameした「Order」を右クリックし、「Add Entity Attribute」をクリックします。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/09d30fbe-a227-417c-8293-8b05e93f8ce7)<br><br>

４．作成したAttributeをクリックし、Nameプロパティに「Code」と入力します。

５．Descriptionプロパティには、Attirbuteの簡単な説明を書きます（このステップは任意ですが、将来プロジェクトを見るときや、チームで作業するときに役立ちます）。

６．Is Mandatoryプロパティをクリックし、ドロップダウンでYesに変更します。（必須項目かどうかのフラグです）

７．Data TypeがTextに設定されていることを確認し、Lengthプロパティに値150を入力します。ここまでで、このAttirbuteのプロパティはこのようになります：

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/ae855b04-f785-4681-8d96-35b5f378c578)<br><br>

８．上記ステップ３〜７を繰り返し、必須項目のAttirbuteとして、Data TypeがCurrencyの「TotalAmount」と、Dateの「OrderDate」を作成します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/7b105a60-b417-4dec-871a-7dff71c05586)
![image](https://github.com/taijihagino/low-code-dev/assets/12064399/abbfa692-9012-4388-b880-b430441f189f)<br><br>

Order Entityは以下の画像のようになっているはずです。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/731c2411-be9f-48a4-9e63-b31da9df1a93)<br><br>

## データ間のリレーションを作成する
Entityを作成したので、次はEntity間のリレーションを作成します。<br>
このアプリケーションでは、**Order**は複数の**Item**を含むことができ、**Item**は複数の**Order**に属することができます。そのため、このリレーションを作成するために、補助Entityを作成する必要があります。これが多対多のリレーション（Many-to-Many Relationship）です。

※ Entityのリレーションについて詳しく知りたい場合は[こちらの公式ドキュメント](https://success.outsystems.com/ja-jp/documentation/11/developing_an_application/use_data/data_modeling/entity_relationships/)が参考になります。

１．前のセクションで行ったように、新しいEntityを作成しましょう。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/3246785b-67e4-4f4e-b4f2-9cc5256f6f0a)<br><br>

２．作成したEntityに「OrderItem」という名前を付けます。このEntityは、1つの商品を1つのOrderに連携するために使用されます。

３．必須項目のAttirbuteとして「Quantity」を追加し、Data Typeを「Integer」に設定します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/171a1d02-9343-4548-a47e-b8094428e852)<br><br>

このAttirbuteは、オーダー内の特定のアイテムの数量を表します。例えば、オーダーには2台のノートパソコンや3台のサングラスが含まれる、といった感じです。

４．必須項目のAttirbuteとして「PricePerItem」を追加し、Data Typeを「Currency」に設定します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/88af40a7-b1e8-40fe-ad1c-3f6b49c168b1)<br><br>

このAttirbuteは個々の商品の単価を保存します。これは後ほど、商品をオーダーに追加するロジックを作成するときに役立ちます。

５．最後の必須項目のAttirbuteとして「Amount」を追加し、Data Typeを「Currency」に設定します。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/03768343-5057-43a4-b57a-40b008ba67fb)<br><br>

このAttributeは、オーダー内のアイテムタイプの合計価格を保存します。例えば、1個100ドルのスピーカーが2個注文されたとします。この場合、金額は$200となります。

６．Dataタブで、「Entity Diagrams」フォルダを展開し「OrderManagementDataModel」をダブルクリックしてダイアグラムのエディターを開きます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/0a3b9b21-015e-4dfe-a0f7-089ffc177dbe)<br><br>

７．DataタブのEntity → Databaseの配下にある、「Order」「OrderItem」「Item」の各エンティティを同時選択します（Ctl+クリック / Cmd+クリックで複数の要素を選択できます）。選択したエンティティを、今開いた空のデータモデルにドラッグ＆ドロップします。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/a62e5a25-8586-4053-8127-2b8e5924d66b)<br><br>

以下の画像のようになります。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/6eb75321-e483-45dd-b90d-55642f75a356)<br><br>

８．ダイアグラム内の「Item Entity」をクリックし、OrderItem Entityの右側にドラッグします。このステップは任意ですが、データモデルをよりよく視覚化するのに役立ちます。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/a771ee88-df01-4f04-898d-9db0463ae89e)<br><br>

９．Order Entityの右側にマウスを置き、「Id Attributeの近くに表示されるコネクタ」を選択し、OrderItem Entityにドラッグします。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/67e5d68f-37cb-435a-9c98-4c8e7d1d59b8)<br><br>

OrderItem Entityに「OrderId」という新しいAttirbuteが作成されました。これは2つのEntityの間にリレーションを作り、1つのItemが1つのOrderに関連付けられることを意味します。

１０．同じ手順をItem Entityに対して繰り返します。Item EntityからOrderItemへのドラッグを忘れないでください。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/2ecf205d-905e-4e37-b12b-7b06c039843b)<br><br>

新しい2つのAttirbuteのアイコンは、他のAttributeとは少し異なっていることに注意してください。これは、他のEntityにリンクされたAttirbuteであるためで、つまりは外部キーです。Attirbuteをクリックすると、それらが特別な識別子を持っていることがわかります。

![image](https://github.com/taijihagino/low-code-dev/assets/12064399/4db85cee-b265-446e-81b7-bc5e8f02b276)<br><br>

## 注文にステータスを追加する


