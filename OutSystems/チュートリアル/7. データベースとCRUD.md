# データベースを作成し、検索履歴を管理しよう
[前章](https://github.com/taijihagino/low-code-dev/blob/main/OutSystems/%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB/6.%20Leaflet%20Map%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E5%9C%B0%E5%9B%B3%E3%82%A2%E3%83%97%E3%83%AA.md)では、Leaflet Mapを配置し、検索した住所にMarker（ピン）を立てる、ということを実装しました。

ここでは、その検索結果のデータをデータベースに保存し、別画面（Screen）で参照する、という機能を実装していきます。

## Entityの作成
１．Dataタブを選択し、Module → Entity → Databaseを右クリックして「Add Entity」を選択します。

<img width="514" alt="Screenshot 2024-01-20 at 21 58 22" src="https://github.com/taijihagino/low-code-dev/assets/12064399/36ffa3d7-8795-42b9-8ed6-88c5bd088fcd">


２．作成したEntityの名前を「History」にします。

<img width="311" alt="Screenshot 2024-01-20 at 21 59 07" src="https://github.com/taijihagino/low-code-dev/assets/12064399/86809aa7-a664-47f2-9252-c47bea9d907b">


３．HistoryにRenameしたEntityを右クリックして「Add Entity Attribute」を選択します。

<img width="389" alt="Screenshot 2024-01-20 at 22 00 16" src="https://github.com/taijihagino/low-code-dev/assets/12064399/1f4caad6-ae4b-4fdf-8f4c-ce89c297e013">


４．作成したAttributeの名前を「UserId」にします。そうすると、OutSystemsが自動で判断して、既存のUser TableにあるUserIdに対して外部キーを貼ってくれます。

<img width="307" alt="Screenshot 2024-01-20 at 22 01 00" src="https://github.com/taijihagino/low-code-dev/assets/12064399/0bc23ff6-564e-4698-9f58-ac61b88c8425">


５．同様の手順で、以下のEntity Attributeを作成します。

- Timestamp
- Zipcode
- City
- Lat
- Long

Timestampだけ、Data Typeを「Date Time」型にします。その他のAttributeは「Text」型のままでOKです。

<img width="307" alt="Screenshot 2024-01-20 at 22 05 19" src="https://github.com/taijihagino/low-code-dev/assets/12064399/2f0c0f06-4887-4195-942b-f22bee768691">


これで、Entityの作成は完了です。

## データ保存処理をサーバーアクションとして作成


## ボタンアクションにデータ保存処理を追加


## 検索履歴表示画面（Screen）の追加


# まとめ
